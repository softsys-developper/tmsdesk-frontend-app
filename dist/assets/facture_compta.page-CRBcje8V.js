import{P as x,Q as U,ab as o,O as k,s as y,R as p,aj as u,S as M,ac as S,ad as O,d as R,o as $,c as h,w as A,_ as w,a as v,b as j,e as d,u as l,g as D,f as E,h as N,i as P,ak as I,j as B,k as V}from"./index-CZaAeDBg.js";import{_ as Y}from"./facture_paid.modal.vue_vue_type_script_setup_true_lang-DDLkhxA5.js";const H=[{label:"ID",field:"id",status:null,color:null,bgColor:null},{label:"Numéro de facture",field:"numero_facture",status:null,color:null,bgColor:null},{label:"Montant TTC",field:"montant_ttc",status:null,color:null,bgColor:null},{label:"Statut",field:"status",status:null,color:null,bgColor:null},{label:"Date de création",field:"date_emission",status:null,color:null,bgColor:null}],L=()=>{const{readData:b,createData:g,deleteData:i,updateData:f}=M(),{EmptyFields:m}=S(),s=x({loading:!1,loadingCreate:!1,loadingDelete:!1,loadingUpdate:!1}),_=U([]);_.value=o().Factures;const{toast:r}=k(),F=(n,t)=>`<span class="flex  text-center text-sm font-bold max-w-max px-2 py-1 rounded-md justify-center text-white ${t}" >${n}</span>`,C=n=>n.map(t=>({id:t.id,numero_facture:t.numero_facture,montant_ttc:t.montant_ttc,status:t.statut==1?F("En attante","bg-orange-500"):t.statut==2?F("Partiellement","bg-blue-500"):F("Payer","bg-green-500"),date_emission:t.date_emission,date_creation:O(t.created_at).format("DD/MM/YYYY")})),T=y(()=>o().Factures);return{FindFactureAll:()=>{s.loading=!0,b(p.FACTURE_LIST).then(n=>{o().Factures=C(n.datas),s.loading=!1}).catch(()=>{s.loading=!1})},FindFactureOne:()=>{},CreateFacture:async n=>(s.loadingCreate=!0,{data:await g(p.FACTURE_CREATE,n).then(e=>{if(e){m(n),s.loadingCreate=!1;let a=o().Factures;const c=C([e.data]);a.unshift(...c),o().Factures=a,u().open=!1,r({title:"Enregistré",description:e.message})}}).catch(e=>{if(s.loadingCreate=!1,e){const a=Object.keys(e.response.data.errors);r(a?{title:a[0],variant:"destructive",description:e.response.data.errors[a[0]][0]}:{title:"error",variant:"destructive",description:e.response.data.message})}})}),FactureUpdate:(n,t)=>{s.loadingCreate=!0,f(p.FACTURE_UPDATE+"/"+n,t).then(e=>{if(e){m(t),s.loadingCreate=!1;let a=o().Factures;const c=C([e.data]);a.unshift(...c),o().Factures=a,u().open=!1,r({title:"Enregistré",description:e.message})}}).catch(e=>{if(s.loadingCreate=!1,e){const a=Object.keys(e.response.data.errors);r(a?{title:a[0],variant:"destructive",description:e.response.data.errors[a[0]][0]}:{title:"error",variant:"destructive",description:e.response.data.message})}})},FactureDelete:n=>{s.loadingDelete=!0,i(p.FACTURE_REMOVE+"/"+n).then(t=>{if(t){s.loadingDelete=!1;let e=o().Factures;const a=e.filter(c=>c.id!=n);e.unshift(...a),o().Factures=e,u().open=!1,u().delete=!1,r({title:"Supprimer",description:t.message})}}).catch(t=>{if(s.loadingDelete=!1,u().delete=!1,t){const e=Object.keys(t.response.data.errors);r(e?{title:e[0],variant:"destructive",description:t.response.data.errors[e[0]][0]}:{title:"error",variant:"destructive",description:t.response.data.message})}})},stateFactures:_,setFacture:s,storeFactures:T}},Q={class:"flex flex-col w-full gap-4 bg-white rounded-lg mb-8"},Z=R({__name:"facture_compta.page",setup(b){const{FindFactureAll:g,storeFactures:i,FactureDelete:f,setFacture:m}=L();return $(()=>{g()}),(s,_)=>(v(),h(w,null,{content:A(()=>[j("section",Q,[d(N,{title:"COMPTABILITES | Factures"},{created:A(()=>[d(Y,{name:"Nouveau versement",title:l(D)().isUpdate.is?"Modifier le versement":"Nouveau versement"},null,8,["title"]),d(E,{funDelete:l(f),id:l(D)().isDelete.id},null,8,["funDelete","id"]),d(E,{funDelete:l(f),id:l(D)().isDelete.id},null,8,["funDelete","id"])]),_:1}),l(i).length!=0?(v(),h(P,{key:0,dataTables:l(i),MenuActions:l(I),display:l(H)},null,8,["dataTables","MenuActions","display"])):B("",!0),d(V,{loading:l(m).loading,data:l(i),name:"Aucune factures"},null,8,["loading","data"])])]),_:1}))}});export{Z as default};
