import{d as j,l as z,m as T,n as v,o as G,c as L,w as l,_ as Q,A as g,p as H,q as J,s as K,a as o,b as s,e as n,h as W,t as c,v as $,x as X,u as t,F as w,y,z as Y,B as Z,C as ee,D as ae,E as se,G as te,H as p,I as le,J as ne,K as ie,L as oe,N as re,O as V,P as q,Q as de,R as A,S as ce,T as ue,U as _e,V as O}from"./index-DOJ4ZCQJ.js";import{u as fe}from"./livraison.hook-bs0cw95b.js";const ve=[{label:"Site Livraison",type:"text",placeholder:"Libelle",name:"site_livraison",value:"",select:[]},{label:"Date depart",type:"date",placeholder:"Date depart",name:"date_depart",value:"",select:[]},{label:"Date retour",type:"date",placeholder:"Ex: Unil",name:"date_retour",value:"",select:[]},{label:"Moyen Livraison",type:"text",placeholder:"Moyen Livraison",name:"moyen_livraison",value:"",select:[]},{label:"Agent Livraison",type:"text",placeholder:"Agent Livraison",name:"agent_livraison",value:"",select:[]},{label:"Chaffeur",type:"text",placeholder:"Ex: Unil",name:"chaffeur",value:"",select:[]}],pe={class:"flex flex-col w-full gap-4 bg-white rounded-lg mb-4"},me={class:"w-11/12 m-auto flex gap-4 items-start pb-24 flex-col"},he={class:"w-full grid grid-cols-2 gap-2"},ge={class:""},ye={class:"w-full bg-white rounded-md space-y-4"},xe={class:"flex w-full flex-col lg:flex-row gap-4"},be={class:"bg-white rounded-md flex flex-col gap-2 w-full"},Le=s("div",{class:"bg-gray-200 rounded-t-md p-3"},[s("span",{class:"text-base font-bold"}," Ajouter des produits ou services ")],-1),$e={class:"gap-2 pb-2"},we={class:"w-full"},Se={class:"flex flex-col w-full gap-3"},qe=["value"],Ae={class:"flex w-full m-auto"},Oe=s("span",{class:""},null,-1),Ie={class:""},Re={class:"flex flex-col gap-2"},Ce=["onClick"],De={class:"flex justify-between w-full"},ke=s("span",{class:""},null,-1),Te=["disabled"],Ve={key:1,class:""},Ee=j({__name:"livraison_add_logic.page",setup(Me){const{toast:S}=z(),{readData:I,showData:M}=H(),d=T({loading:!1}),R=v(),P=v([]),x=v([]),m=v([]),u=T({id:"",quantite:"",reference:"",produit_service_id:"",quantite_livree:""}),h=v(!1),C=J(),_=K(),U=()=>{d.loading=!0,I(g.PRODUCT_LIST).then(e=>{P.value=e.datas,d.loading=!1}).catch(()=>{d.loading=!1}),I(g.PROFORMA_LIST).then(e=>{R.value=e.datas,d.loading=!1}).catch(()=>{d.loading=!1})},E=e=>{var i,a;console.log(e),m.value.push({reference:e.reference,id:(i=x.value.find(r=>r.reference==e.reference))==null?void 0:i.id,produit_service_id:(a=x.value.find(r=>r.reference==e.reference))==null?void 0:a.id,quantite:e.quantite,quantite_livree:e.quantite})},N=e=>{m.value=m.value.filter(i=>i.id!==e)},D=v(),F=e=>{console.log(e.target.value),D.value=e.target.value,M(g.PRODUCT_PROFORMA_LIST,e.target.value).then(i=>{x.value=i.datas,d.loading=!1}).catch(()=>{d.loading=!1})},{formatLivraisonData:k}=fe(),B=async()=>{try{h.value=!0;const e=r=>{const f=document.querySelector(`#${r}`);return f==null?void 0:f.value},i={livraisonId:D.value,produits_livres:JSON.stringify(m.value),site_livraison:e("site_livraison"),date_depart:e("date_depart"),date_retour:e("date_retour"),moyen_livraison:e("date_retour"),agent_livraison:e("date_retour"),chauffeur:e("chaffeur")},{data:a}=await _e.post(_.query.id?`${g.PROFORMA_UPDATE}/${_.query.id}`:`${g.LIVRAISON_CREATE}`,i);if(a){const r=a;if(h.value=!1,S({title:"Livraisons",description:r.message}),!_.query.id)O().Livraisons.unshift(...k([a.data])),C.push({name:"LOGISC_LIVRAISONS"});else{const f=O().Livraisons.map(b=>(console.log(b.id==_.query.id),b.id==_.query.id&&(b=k([a.data])),{...b}));O().Livraisons=f,C.push({name:"LOGISC_LIVRAISONS"})}}}catch(e){if(h.value=!1,e!=null&&e.errors)S({title:e.errors[0].path[0],variant:"destructive",description:e.errors[0].message});else{const i=Object.keys(e.response.data.errors);S({title:i[0],variant:"destructive",description:e.response.data.errors[i[0]][0]})}}};return G(()=>{U()}),(e,i)=>(o(),L(Q,null,{content:l(()=>[s("section",pe,[n(W,{title:`Livraion | ${e.$route.query.id?"Modifier":"Création"}`},{created:l(()=>[]),_:1},8,["title"]),s("div",me,[s("div",he,[(o(!0),c(w,null,$(t(ve),a=>(o(),c("div",ge,[n(X,{title:a.label,name:a.name,label:a.label,type:a.type,placeholder:a.placeholder,select:a.select},null,8,["title","name","label","type","placeholder","select"])]))),256))]),s("div",ye,[s("div",xe,[s("div",be,[Le,s("div",$e,[s("div",we,[s("div",Se,[s("select",{name:"",id:"",onInput:F,class:"p-2 border-[1px] rounded-md"},[(o(!0),c(w,null,$(R.value,a=>(o(),c("option",{value:a.id},y(a.numero_livraison),9,qe))),256))],32),n(t(le),{class:"flex flex-col",modelValue:u.reference,"onUpdate:modelValue":i[0]||(i[0]=a=>u.reference=a)},{default:l(()=>[n(t(Y),null,{default:l(()=>[n(t(Z),{placeholder:"Chossisez le product"})]),_:1}),n(t(ee),null,{default:l(()=>[n(t(ae),null,{default:l(()=>[n(t(se)),(o(!0),c(w,null,$(x.value,a=>(o(),L(t(te),{value:a.reference},{default:l(()=>[p(y(a.reference),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1})]),_:1},8,["modelValue"]),ne(s("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=a=>u.quantite=a),class:"border-[1px] w-full rounded-md py-2 px-4"},null,512),[[ie,u.quantite]])])])]),s("div",Ae,[Oe,n(oe,{disabled:u.quantite=="",onClick:i[2]||(i[2]=a=>E(u)),class:"bg-gray-800 text-white px-3 text-sm font-bold py-2 rounded-md"},{default:l(()=>[p(" Ajouter ")]),_:1},8,["disabled"])])]),n(t(ce),{class:"bg-orange-50/50 w-full"},{default:l(()=>[n(t(re),{class:"bg-gray-800"},{default:l(()=>[n(t(V),null,{default:l(()=>[n(t(q),null,{default:l(()=>[p("Reference")]),_:1}),n(t(q),null,{default:l(()=>[p("Quantités")]),_:1}),n(t(q),{class:""},{default:l(()=>[p(" Actions ")]),_:1})]),_:1})]),_:1}),n(t(de),null,{default:l(()=>[(o(!0),c(w,null,$(m.value,(a,r)=>(o(),L(t(V),{key:r},{default:l(()=>[n(t(A),null,{default:l(()=>[s("div",Ie,[s("span",Re,y(a.reference),1)])]),_:2},1024),n(t(A),{class:"font-medium"},{default:l(()=>[p(y(a.quantite),1)]),_:2},1024),n(t(A),{class:"text-right"},{default:l(()=>[s("i",{class:"ri-close-fill cursor-pointer",onClick:f=>N(a.id)},null,8,Ce)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s("div",De,[ke,s("button",{onClick:B,class:"bg-gray-800 px-4 py-2 font-bold text-white rounded-md",disabled:h.value},[h.value?(o(),L(ue,{key:0,size:"w-6 h-6"})):(o(),c("span",Ve,y(t(_).query.id?"Modification une livraison":"Créer une livraison"),1))],8,Te)])])])])]),_:1}))}});export{Ee as default};
