import{P,Q as $,aa as o,O as I,s as N,a8 as p,ak as b,ab as U,ac as k,ad as O,d as x,o as S,a as C,c as A,w as E,b as w,T as v,U as R,V as j,u as l,e as f,W as B,al as L,g as D,_ as V,f as T,h as H,am as Y,i as Q,j as q,k as W}from"./index-S7Y4FJNc.js";import{u as z,F as y}from"./facture_paid.forms-D-KxXlZJ.js";const G=[{label:"ID",field:"id",status:null,color:null,bgColor:null},{label:"Numéro de facture",field:"numero_facture",status:null,color:null,bgColor:null},{label:"Montant TTC",field:"montant_ttc",status:null,color:null,bgColor:null},{label:"Statut",field:"status",status:null,color:null,bgColor:null},{label:"Date de création",field:"date_emission",status:null,color:null,bgColor:null}],J=()=>{const{readData:h,createData:_,deleteData:u,updateData:m}=U(),{EmptyFields:d}=k(),a=P({loading:!1,loadingCreate:!1,loadingDelete:!1,loadingUpdate:!1}),F=$([]);F.value=o().Factures;const{toast:s}=I(),c=(r,t)=>`<span class="flex  text-center text-sm font-bold max-w-max px-2 py-1 rounded-md justify-center text-white ${t}" >${r}</span>`,i=r=>r.map(t=>({id:t.id,numero_facture:t.numero_facture,montant_ttc:new Intl.NumberFormat("de-DE",{style:"currency",currency:"CFA"}).format(t.montant_ttc),reste_a_payer:new Intl.NumberFormat("de-DE",{style:"currency",currency:"CFA"}).format(t.reste_a_payer),status:t.statut==1?c("En attante","bg-orange-500"):t.statut==2?c("Partiellement","bg-blue-500"):c("Payer","bg-green-500"),date_emission:t.date_emission,date_creation:O(t.created_at).format("DD/MM/YYYY")})),M=N(()=>o().Factures);return{FindFactureAll:()=>{a.loading=!0,h(p.FACTURE_LIST).then(r=>{o().Factures=i(r.datas),a.loading=!1}).catch(()=>{a.loading=!1})},FindFactureOne:()=>{},CreateFacture:async r=>(a.loadingCreate=!0,{data:await _(p.FACTURE_CREATE,r).then(e=>{if(e){d(r),a.loadingCreate=!1;let n=o().Factures;const g=i([e.data]);n.unshift(...g),o().Factures=n,b().open=!1,s({title:"Enregistré",description:e.message})}}).catch(e=>{if(a.loadingCreate=!1,e){const n=Object.keys(e.response.data.errors);s(n?{title:n[0],variant:"destructive",description:e.response.data.errors[n[0]][0]}:{title:"error",variant:"destructive",description:e.response.data.message})}})}),FactureUpdate:(r,t)=>{a.loadingCreate=!0,m(p.FACTURE_UPDATE+"/"+r,t).then(e=>{if(e){d(t),a.loadingCreate=!1;let n=o().Factures;const g=i([e.data]);n.unshift(...g),o().Factures=n,b().open=!1,s({title:"Enregistré",description:e.message})}}).catch(e=>{if(a.loadingCreate=!1,e){const n=Object.keys(e.response.data.errors);s(n?{title:n[0],variant:"destructive",description:e.response.data.errors[n[0]][0]}:{title:"error",variant:"destructive",description:e.response.data.message})}})},FactureDelete:r=>{a.loadingDelete=!0,u(p.FACTURE_REMOVE+"/"+r).then(t=>{if(t){a.loadingDelete=!1;let e=o().Factures;const n=e.filter(g=>g.id!=r);e.unshift(...n),o().Factures=e,b().open=!1,b().delete=!1,s({title:"Supprimer",description:t.message})}}).catch(t=>{if(a.loadingDelete=!1,b().delete=!1,t){const e=Object.keys(t.response.data.errors);s(e?{title:e[0],variant:"destructive",description:t.response.data.errors[e[0]][0]}:{title:"error",variant:"destructive",description:t.response.data.message})}})},stateFactures:F,setFacture:a,storeFactures:M}},K={class:"w-full space-y-2"},X={class:""},Z=x({__name:"facture_paid.modal",setup(h){const{CreateFacturePaid:_,FacturePaidUpdate:u,setFacturePaid:m}=z(),{remplacerObjetDansTableau:d}=k(),{readData:a}=U(),F=s=>{let c=new FormData(s.target);D().isUpdate.is?u(D().isUpdate.id,c):_(c)};return S(()=>{o().Factures&&(a(p.BANQUE_LIST).then(s=>{o().Comptes=s.datas,d(y,"name","banque",s.datas)}),a(p.FACTURE_LIST).then(s=>{d(y,"name","factureId",s.datas.map(c=>({id:c.id,name:c.numero_facture})))}))}),(s,c)=>(C(),A(L,{Func:F,loading:l(m).loadingCreate,permissions:"payer-facture-client"},{form:E(()=>[w("div",K,[(C(!0),v(R,null,j(l(y),i=>(C(),v("div",X,[f(B,{title:i.label,name:i.name,label:i.label,type:i.type,placeholder:i.placeholder,select:i.select},null,8,["title","name","label","type","placeholder","select"])]))),256))])]),_:1},8,["loading"]))}}),ee={class:"flex flex-col w-full gap-4 bg-white rounded-lg mb-8"},ce=x({__name:"facture_compta.page",setup(h){const{FindFactureAll:_,storeFactures:u,FactureDelete:m,setFacture:d}=J();return S(()=>{_()}),(a,F)=>(C(),A(W,null,{content:E(()=>[w("section",ee,[f(V,{title:"COMPTABILITES | Factures"},{created:E(()=>[f(Z,{name:"Nouveau versement",title:l(D)().isUpdate.is?"Modifier le versement":"Nouveau versement"},null,8,["title"]),f(T,{funDelete:l(m),id:l(D)().isDelete.id},null,8,["funDelete","id"]),f(T,{funDelete:l(m),id:l(D)().isDelete.id},null,8,["funDelete","id"])]),_:1}),l(u).length!=0?(C(),A(H,{key:0,dataTables:l(u),MenuActions:l(Y),display:l(G)},null,8,["dataTables","MenuActions","display"])):Q("",!0),f(q,{loading:l(d).loading,data:l(u),name:"Aucune factures"},null,8,["loading","data"])])]),_:1}))}});export{ce as default};
