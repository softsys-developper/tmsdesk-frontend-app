import{m as x,n as U,V as o,l as y,W as k,A as p,Y as u,p as M,Z as S,X as $,d as w,o as O,c as A,w as h,_ as R,a as v,b as N,e as d,u as l,g as b,f as E,h as j,i as I,a0 as P,j as V,k as B}from"./index-ytZibm8n.js";import{_ as H}from"./facture_paid.modal.vue_vue_type_script_setup_true_lang-yF-UqW6o.js";const L=[{label:"ID",field:"id",status:null,color:null,bgColor:null},{label:"Numéro de facture",field:"numero_facture",status:null,color:null,bgColor:null},{label:"Montant TTC",field:"montant_ttc",status:null,color:null,bgColor:null},{label:"Statut",field:"status",status:null,color:null,bgColor:null},{label:"Date de création",field:"date_emission",status:null,color:null,bgColor:null}],W=()=>{const{readData:D,createData:g,deleteData:i,updateData:f}=M(),{EmptyFields:m}=S(),s=x({loading:!1,loadingCreate:!1,loadingDelete:!1,loadingUpdate:!1}),_=U([]);_.value=o().Factures;const{toast:r}=y(),F=(n,t)=>`<span class="flex  text-center text-sm font-bold max-w-max px-2 py-1 rounded-md justify-center text-white ${t}" >${n}</span>`,C=n=>n.map(t=>({id:t.id,numero_facture:t.numero_facture,montant_ttc:t.montant_ttc,status:t.statut==1?F("En attante","bg-orange-500"):t.statut==2?F("Partiellement","bg-blue-500"):F("Payer","bg-green-500"),date_emission:t.date_emission,date_creation:$(t.created_at).format("l")})),T=k(()=>o().Factures);return{FindFactureAll:()=>{s.loading=!0,D(p.FACTURE_LIST).then(n=>{o().Factures=C(n.datas),s.loading=!1}).catch(()=>{s.loading=!1})},FindFactureOne:()=>{},CreateFacture:async n=>(s.loadingCreate=!0,{data:await g(p.FACTURE_CREATE,n).then(e=>{if(e){m(n),s.loadingCreate=!1;let a=o().Factures;const c=C([e.data]);a.unshift(...c),o().Factures=a,u().open=!1,r({title:"Enregistré",description:e.message})}}).catch(e=>{if(s.loadingCreate=!1,e){const a=Object.keys(e.response.data.errors);r(a?{title:a[0],variant:"destructive",description:e.response.data.errors[a[0]][0]}:{title:"error",variant:"destructive",description:e.response.data.message})}})}),FactureUpdate:(n,t)=>{s.loadingCreate=!0,f(p.FACTURE_UPDATE+"/"+n,t).then(e=>{if(e){m(t),s.loadingCreate=!1;let a=o().Factures;const c=C([e.data]);a.unshift(...c),o().Factures=a,u().open=!1,r({title:"Enregistré",description:e.message})}}).catch(e=>{if(s.loadingCreate=!1,e){const a=Object.keys(e.response.data.errors);r(a?{title:a[0],variant:"destructive",description:e.response.data.errors[a[0]][0]}:{title:"error",variant:"destructive",description:e.response.data.message})}})},FactureDelete:n=>{s.loadingDelete=!0,i(p.FACTURE_REMOVE+"/"+n).then(t=>{if(t){s.loadingDelete=!1;let e=o().Factures;const a=e.filter(c=>c.id!=n);e.unshift(...a),o().Factures=e,u().open=!1,u().delete=!1,r({title:"Supprimer",description:t.message})}}).catch(t=>{if(s.loadingDelete=!1,u().delete=!1,t){const e=Object.keys(t.response.data.errors);r(e?{title:e[0],variant:"destructive",description:t.response.data.errors[e[0]][0]}:{title:"error",variant:"destructive",description:t.response.data.message})}})},stateFactures:_,setFacture:s,storeFactures:T}},X={class:"flex flex-col w-full gap-4 bg-white rounded-lg mb-8"},Q=w({__name:"facture_compta.page",setup(D){const{FindFactureAll:g,storeFactures:i,FactureDelete:f,setFacture:m}=W();return O(()=>{g()}),(s,_)=>(v(),A(R,null,{content:h(()=>[N("section",X,[d(j,{title:"COMPTABILITES | Factures"},{created:h(()=>[d(H,{name:"Nouveau versement",title:l(b)().isUpdate.is?"Modifier le versement":"Nouveau versement"},null,8,["title"]),d(E,{funDelete:l(f),id:l(b)().isDelete.id},null,8,["funDelete","id"]),d(E,{funDelete:l(f),id:l(b)().isDelete.id},null,8,["funDelete","id"])]),_:1}),l(i).length!=0?(v(),A(I,{key:0,dataTables:l(i),MenuActions:l(P),display:l(L)},null,8,["dataTables","MenuActions","display"])):V("",!0),d(B,{loading:l(m).loading,data:l(i),name:"Aucune factures"},null,8,["loading","data"])])]),_:1}))}});export{Q as default};
